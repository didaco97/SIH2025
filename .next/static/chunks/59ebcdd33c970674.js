(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,531278,e=>{"use strict";let t=(0,e.i(475254).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],531278)},63209,e=>{"use strict";let t=(0,e.i(475254).default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>t],63209)},793479,e=>{"use strict";var t=e.i(843476),a=e.i(271645),s=e.i(975157);let r=a.forwardRef(({className:e,type:a,...r},l)=>(0,t.jsx)("input",{type:a,className:(0,s.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:l,...r}));r.displayName="Input",e.s(["Input",()=>r])},110204,e=>{"use strict";var t=e.i(843476),a=e.i(271645),s=e.i(248425),r=a.forwardRef((e,a)=>(0,t.jsx)(s.Primitive.label,{...e,ref:a,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));r.displayName="Label";var l=e.i(225913),i=e.i(975157);let n=(0,l.cva)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=a.forwardRef(({className:e,...a},s)=>(0,t.jsx)(r,{ref:s,className:(0,i.cn)(n(),e),...a}));o.displayName=r.displayName,e.s(["Label",()=>o],110204)},232189,(e,t,a)=>{"use strict";t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},865156,(e,t,a)=>{"use strict";var s=e.r(232189);function r(){}function l(){}l.resetWarningCache=r,t.exports=function(){function e(e,t,a,r,l,i){if(i!==s){var n=Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw n.name="Invariant Violation",n}}function t(){return e}e.isRequired=e;var a={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:l,resetWarningCache:r};return a.PropTypes=a,a}},745009,(e,t,a)=>{t.exports=e.r(865156)()},826633,e=>{"use strict";e.i(436180);var t=e.i(98925),a=e.i(959141);async function s(e){let t=new TextEncoder().encode(e);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")}function r(){if(!a.db)throw Error("Firebase is not configured. Please set up your .env.local file with Firebase credentials. Copy .env.example to .env.local and add your Firebase config.");return a.db}async function l(){let e=new Date().getFullYear(),a=(0,t.query)((0,t.collection)(r(),"claims"),(0,t.orderBy)("createdAt","desc")),s=(await (0,t.getDocs)(a)).size+1;return`CLM-${e}-${String(s).padStart(4,"0")}`}async function i(e){let a=await l();return(await (0,t.addDoc)((0,t.collection)(r(),"claims"),{...e,claimNumber:a,status:e.status||"pending",createdAt:(0,t.serverTimestamp)(),updatedAt:(0,t.serverTimestamp)()})).id}async function n(e){let a=await (0,t.getDoc)((0,t.doc)(r(),"claims",e));return a.exists()?{id:e,...a.data()}:null}async function o(){let e=(0,t.query)((0,t.collection)(r(),"claims"),(0,t.orderBy)("createdAt","desc"));return(await (0,t.getDocs)(e)).docs.map(e=>({id:e.id,...e.data()}))}async function c(e,a,s,l){await (0,t.updateDoc)((0,t.doc)(r(),"claims",e),{status:a,officerNotes:s,processedBy:l,processedAt:(0,t.serverTimestamp)(),updatedAt:(0,t.serverTimestamp)()})}async function d(e,a,s){await (0,t.updateDoc)((0,t.doc)(r(),"claims",e),{blockchainTxHash:a,blockchainExplorerUrl:s,updatedAt:(0,t.serverTimestamp)()})}async function u(e){let a={...e,featuresJson:JSON.stringify(e.features),features:void 0,createdAt:(0,t.serverTimestamp)()};return delete a.features,(await (0,t.addDoc)((0,t.collection)(r(),"segmentedFarms"),a)).id}async function m(){let e=(0,t.query)((0,t.collection)(r(),"segmentedFarms"),(0,t.orderBy)("createdAt","desc"));return(await (0,t.getDocs)(e)).docs.map(e=>{let t=e.data(),a=t.featuresJson?JSON.parse(t.featuresJson):[];return{id:e.id,...t,features:a}})}async function h(e){let a=await (0,t.getDoc)((0,t.doc)(r(),"segmentedFarms",e));if(a.exists()){let t=a.data(),s=t.featuresJson?JSON.parse(t.featuresJson):[];return{id:e,...t,features:s}}return null}async function p(e){await (0,t.deleteDoc)((0,t.doc)(r(),"segmentedFarms",e))}async function f(e){let a,l=await (0,t.addDoc)((0,t.collection)(r(),"reports"),{...e,createdAt:(0,t.serverTimestamp)()});if(e.claimId){let i=`${e.pdfUrl}-${Date.now()}`;a=await s(i),await (0,t.updateDoc)((0,t.doc)(r(),"claims",e.claimId),{reportId:l.id,reportUrl:e.pdfUrl,status:"waiting",reportGeneratedAt:(0,t.serverTimestamp)(),blockchainHash:a,updatedAt:(0,t.serverTimestamp)()})}return{reportId:l.id,blockchainHash:a}}function x(e,a,s){let l=[(0,t.where)("status","==",e)],i=(0,t.query)((0,t.collection)(r(),"claims"),...l);return(0,t.onSnapshot)(i,e=>{let t=e.docs.map(e=>({id:e.id,...e.data()}));t.sort((e,t)=>{let a=e.createdAt?.toMillis()||0;return(t.createdAt?.toMillis()||0)-a}),s&&s>0&&(t=t.slice(0,s)),a(t)})}e.s(["createClaim",()=>i,"deleteSegmentedFarm",()=>p,"getAllClaims",()=>o,"getClaim",()=>n,"getSegmentedFarmById",()=>h,"getSegmentedFarms",()=>m,"saveReport",()=>f,"saveSegmentedFarm",()=>u,"subscribeToClaimsByStatus",()=>x,"updateClaimBlockchainInfo",()=>d,"updateClaimStatus",()=>c],826633)},497485,e=>{"use strict";var t=e.i(843476),a=e.i(525883),s=e.i(260289),r=e.i(178583),l=e.i(217923);let i=[{title:"Main Dashboard",url:"/farmer",icon:s.LayoutDashboard},{title:"Claims",url:"/farmer/claims",icon:r.FileText},{title:"Analytics",url:"/farmer/analytics",icon:l.BarChart3}];function n(){return(0,t.jsx)("aside",{className:"w-56 min-h-screen bg-card border-r border-border shadow-sidebar",children:(0,t.jsxs)("div",{className:"p-5",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-8",children:[(0,t.jsx)("img",{src:"/logo.png",alt:"Kisan Portal",className:"w-10 h-10 rounded-xl object-contain"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"font-display font-bold text-foreground text-sm",children:"Kisan Portal"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Crop Insurance"})]})]}),(0,t.jsx)("nav",{className:"space-y-1",children:i.map(e=>(0,t.jsxs)(a.NavLink,{to:e.url,end:"/farmer"===e.url,className:"flex items-center gap-3 px-4 py-3 rounded-lg text-muted-foreground hover:bg-secondary hover:text-foreground transition-all duration-200 text-sm",activeClassName:"bg-primary/10 text-primary font-medium",children:[(0,t.jsx)(e.icon,{className:"w-5 h-5"}),(0,t.jsx)("span",{children:e.title})]},e.title))})]})})}e.s(["FarmerSidebar",()=>n])},514764,e=>{"use strict";let t=(0,e.i(475254).default)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);e.s(["Send",()=>t],514764)},103053,e=>{"use strict";e.i(961086);var t=e.i(527215),a=e.i(959141);function s(){if(!a.storage)throw Error("Firebase Storage is not configured. Please set up your .env.local file with Firebase credentials. Copy .env.example to .env.local and add your Firebase config.");return a.storage}async function r(e,a,r){let l=(0,t.ref)(s(),a);if(!r)return await (0,t.uploadBytes)(l,e),(0,t.getDownloadURL)(l);{let a=(0,t.uploadBytesResumable)(l,e);return new Promise((e,s)=>{a.on("state_changed",e=>{r(e.bytesTransferred/e.totalBytes*100)},e=>{s(e)},async()=>{e(await (0,t.getDownloadURL)(a.snapshot.ref))})})}}async function l(e,t,a,s){let l=Date.now(),i=e.name.replace(/[^a-zA-Z0-9.-]/g,"_");return r(e,a?`documents/${t}/${a}/${l}_${i}`:`documents/${t}/${l}_${i}`,s)}async function i(e,a,r){let l=Date.now(),i=r.replace(/[^a-zA-Z0-9.-]/g,"_"),n=`reports/${a}/${l}_${i}`,o=(0,t.ref)(s(),n);return await (0,t.uploadBytes)(o,e),(0,t.getDownloadURL)(o)}e.s(["uploadDocument",()=>l,"uploadReportPDF",()=>i])},595468,e=>{"use strict";let t=(0,e.i(475254).default)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);e.s(["CheckCircle2",()=>t],595468)},624687,e=>{"use strict";var t=e.i(843476),a=e.i(271645),s=e.i(975157);let r=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("textarea",{className:(0,s.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...a}));r.displayName="Textarea",e.s(["Textarea",()=>r])},283086,88653,357772,e=>{"use strict";let t=(0,e.i(475254).default)("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);e.s(["Sparkles",()=>t],283086),e.i(247167);var a=e.i(843476),s=e.i(271645),r=e.i(231178),l=e.i(947414),i=e.i(674008),n=e.i(821476),o=e.i(772846),c=s,d=e.i(737806);function u(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}class m extends c.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=t.offsetParent,a=(0,o.isHTMLElement)(e)&&e.offsetWidth||0,s=this.props.sizeRef.current;s.height=t.offsetHeight||0,s.width=t.offsetWidth||0,s.top=t.offsetTop,s.left=t.offsetLeft,s.right=a-s.width-s.left}return null}componentDidUpdate(){}render(){return this.props.children}}function h({children:e,isPresent:t,anchorX:r,root:l}){let i=(0,c.useId)(),n=(0,c.useRef)(null),o=(0,c.useRef)({width:0,height:0,top:0,left:0,right:0}),{nonce:h}=(0,c.useContext)(d.MotionConfigContext),p=function(...e){return s.useCallback(function(...e){return t=>{let a=!1,s=e.map(e=>{let s=u(e,t);return a||"function"!=typeof s||(a=!0),s});if(a)return()=>{for(let t=0;t<s.length;t++){let a=s[t];"function"==typeof a?a():u(e[t],null)}}}}(...e),e)}(n,e?.ref);return(0,c.useInsertionEffect)(()=>{let{width:e,height:a,top:s,left:c,right:d}=o.current;if(t||!n.current||!e||!a)return;let u="left"===r?`left: ${c}`:`right: ${d}`;n.current.dataset.motionPopId=i;let m=document.createElement("style");h&&(m.nonce=h);let p=l??document.head;return p.appendChild(m),m.sheet&&m.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${e}px !important;
            height: ${a}px !important;
            ${u}px !important;
            top: ${s}px !important;
          }
        `),()=>{p.contains(m)&&p.removeChild(m)}},[t]),(0,a.jsx)(m,{isPresent:t,childRef:n,sizeRef:o,children:c.cloneElement(e,{ref:p})})}let p=({children:e,initial:t,isPresent:r,onExitComplete:i,custom:o,presenceAffectsLayout:c,mode:d,anchorX:u,root:m})=>{let p=(0,l.useConstant)(f),x=(0,s.useId)(),g=!0,y=(0,s.useMemo)(()=>(g=!1,{id:x,initial:t,isPresent:r,custom:o,onExitComplete:e=>{for(let t of(p.set(e,!0),p.values()))if(!t)return;i&&i()},register:e=>(p.set(e,!1),()=>p.delete(e))}),[r,p,i]);return c&&g&&(y={...y}),(0,s.useMemo)(()=>{p.forEach((e,t)=>p.set(t,!1))},[r]),s.useEffect(()=>{r||p.size||!i||i()},[r]),"popLayout"===d&&(e=(0,a.jsx)(h,{isPresent:r,anchorX:u,root:m,children:e})),(0,a.jsx)(n.PresenceContext.Provider,{value:y,children:e})};function f(){return new Map}var x=e.i(464978);let g=e=>e.key||"";function y(e){let t=[];return s.Children.forEach(e,e=>{(0,s.isValidElement)(e)&&t.push(e)}),t}let v=({children:e,custom:t,initial:n=!0,onExitComplete:o,presenceAffectsLayout:c=!0,mode:d="sync",propagate:u=!1,anchorX:m="left",root:h})=>{let[f,v]=(0,x.usePresence)(u),b=(0,s.useMemo)(()=>y(e),[e]),j=u&&!f?[]:b.map(g),N=(0,s.useRef)(!0),w=(0,s.useRef)(b),S=(0,l.useConstant)(()=>new Map),[C,F]=(0,s.useState)(b),[D,k]=(0,s.useState)(b);(0,i.useIsomorphicLayoutEffect)(()=>{N.current=!1,w.current=b;for(let e=0;e<D.length;e++){let t=g(D[e]);j.includes(t)?S.delete(t):!0!==S.get(t)&&S.set(t,!1)}},[D,j.length,j.join("-")]);let I=[];if(b!==C){let e=[...b];for(let t=0;t<D.length;t++){let a=D[t],s=g(a);j.includes(s)||(e.splice(t,0,a),I.push(a))}return"wait"===d&&I.length&&(e=I),k(y(e)),F(b),null}let{forceRender:T}=(0,s.useContext)(r.LayoutGroupContext);return(0,a.jsx)(a.Fragment,{children:D.map(e=>{let s=g(e),r=(!u||!!f)&&(b===D||j.includes(s));return(0,a.jsx)(p,{isPresent:r,initial:(!N.current||!!n)&&void 0,custom:t,presenceAffectsLayout:c,mode:d,root:h,onExitComplete:r?void 0:()=>{if(!S.has(s))return;S.set(s,!0);let e=!0;S.forEach(t=>{t||(e=!1)}),e&&(T?.(),k(w.current),u&&v?.(),o&&o())},anchorX:m,children:e},s)})})};e.s(["AnimatePresence",()=>v],88653);let b=(0,e.i(33550).default)("outline","x","X",[["path",{d:"M18 6l-12 12",key:"svg-0"}],["path",{d:"M6 6l12 12",key:"svg-1"}]]);e.s(["IconX",()=>b],357772)},559062,e=>{"use strict";var t=e.i(843476),a=e.i(497485),s=e.i(519455),r=e.i(793479),l=e.i(110204),i=e.i(624687),n=e.i(967489),o=e.i(111110),c=e.i(557951),d=e.i(178583),u=e.i(514764),m=e.i(531278),h=e.i(915338),p=e.i(283086),f=e.i(63209),x=e.i(595468),g=e.i(271645),y=e.i(846932),v=e.i(88653),b=e.i(888518),j=e.i(357772),N=e.i(826633),w=e.i(103053);e.i(436180);var S=e.i(98925),C=e.i(846696),F=e.i(618566);function D(){let{t:e}=(0,o.useLanguage)(),{user:D,userProfile:k,isConfigured:I}=(0,c.useAuth)(),T=(0,F.useRouter)(),[A,L]=(0,g.useState)(null),[P,R]=(0,g.useState)(!1),[E,M]=(0,g.useState)(!1),[O,$]=(0,g.useState)(null),[U,z]=(0,g.useState)(null),[B,V]=(0,g.useState)(null),[_,q]=(0,g.useState)({farmerId:"",farmerName:"",otherNames:"",village:"",district:"",surveyNo:"",farmCoordinates:"",cropType:"",area:"",policyNumber:"",lossDate:"",lossType:"",cropStage:"",harvestDate:"",description:""}),[W,H]=(0,g.useState)([]),[J,G]=(0,g.useState)(null),[Y,X]=(0,g.useState)(!1);(0,g.useEffect)(()=>{U&&G(U)},[U]);let K=async e=>[],Z=async()=>{if(U){M(!0),$(null),V(null);try{var e;let t,a,s,r,l,i,n,o=[];o="application/pdf"===U.type?await K(U):[await new Promise(e=>{let t=new FileReader;t.onloadend=()=>e(t.result),t.readAsDataURL(U)})];let c="",d=null;for(let e=0;e<o.length;e++){let t=await fetch("/api/ocr",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:o[e]})});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to extract text")}let a=await t.json();c+=a.text,a.structuredData&&(!d||0===e)&&(d=a.structuredData)}let u=d||(e=c,t=e=>e?.replace(/[:\-\.]/g,"").trim()||"",a=e.match(/गाव\s*[:\-]+\s*(?!नमुना)([^\s\n]+)/)||e.match(/Village\s*[:\-]+\s*([^\s\n]+)/i),s=e.match(/तालुका\s*[:\-]+\s*([^\s\n]+)/)||e.match(/Taluka\s*[:\-]+\s*([^\s\n]+)/i),r=e.match(/जिल्हा\s*[:\-]+\s*([^\s\n]+)/)||e.match(/District\s*[:\-]+\s*([^\s\n]+)/i),l=e.match(/भूमापन\s*क्रमांक\s*[:\-\s]*([\d\w\/]+)/)||e.match(/गट\s*क्रमांक\s*[:\-\s]*([\d\w\/]+)/)||e.match(/Survey\s*No\.?\s*[:\-\s]*([\d\w\/]+)/i),i=e.match(/खातेदारांची\s*नावे\s*[:\-]*\s*([^\n]+)/)||e.match(/खातेदार\s*[:\-]*\s*([^\n]+)/)||e.match(/Name\s*[:\-]*\s*([^\n]+)/i),n=e.match(/एकूण\s*[:\-\s]*([\d\.१२३४५६७८९०]+)/)||e.match(/क्षेत्र\s*[:\-\s]*([\d\.१२३४५६७८९०]+)/)||e.match(/Area\s*[:\-\s]*([\d\.]+)/i),{surveyNumber:t(l?.[1]||""),ownerName:t(i?.[1]||""),village:t(a?.[1]||""),taluka:t(s?.[1]||""),district:t(r?.[1]||""),area:n?.[1]?(e=>{if(!e)return e;let t={"०":"0","१":"1","२":"2","३":"3","४":"4","५":"5","६":"6","७":"7","८":"8","९":"9"};return e.replace(/[०-९]/g,e=>t[e]||e)})(n[1]):"",coordinates:"Not Found"});V(u);let m=u.area?.replace(/[^\d.]/g,"");q(e=>({...e,otherNames:"Not Found"!==u.ownerName?u.ownerName:e.otherNames,village:"Not Found"!==u.village?u.village:e.village,district:"Not Found"!==u.district?u.district:e.district,surveyNo:"Not Found"!==u.surveyNumber?u.surveyNumber:e.surveyNo,area:m||e.area,description:`${e.description}

Auto-detected from 7/12:
Survey No: ${u.surveyNumber}
Coordinates: ${u.coordinates||"Not Found"}`.trim()})),C.toast.success("Document analyzed & form auto-filled!")}catch(e){console.error("Analysis Error:",e),$(e.message||"Failed to analyze document"),C.toast.error("Analysis failed")}finally{M(!1)}}},Q=async e=>{if(e.preventDefault(),console.log("Auth State:",{user:D?.uid,isConfigured:I,userProfile:k}),!D?.uid||!I)return void C.toast.error((0,t.jsxs)("div",{children:["Please ",(0,t.jsx)("a",{href:"/login",className:"underline font-bold",children:"log in"})," to submit a claim"]}));if(!_.farmerId||!_.farmerName||!_.lossType||!_.cropStage||!_.lossDate)return void C.toast.error("Please fill in all required fields");try{let e,t,a;R(!0);let s=[];for(let e of W){let t=await (0,w.uploadDocument)(e,D.uid);s.push(t)}if(J&&(e=await (0,w.uploadDocument)(J,D.uid)),_.farmCoordinates){let e=_.farmCoordinates.split(",").map(e=>parseFloat(e.trim()));2!==e.length||isNaN(e[0])||isNaN(e[1])||(t=e[0],a=e[1])}let r={farmerId:_.farmerId,farmerName:_.farmerName,userId:D.uid,filedBy:"farmer",village:_.village,district:_.district||k?.district||"",surveyNumber:_.surveyNo||"",cropType:_.cropType||"Rice",area:parseFloat(_.area)||0,areaUnit:"acres",policyNumber:_.policyNumber||"",lossType:_.lossType,lossDate:S.Timestamp.fromDate(new Date(_.lossDate)),cropStage:_.cropStage,description:_.description||"",amount:0,status:"pending",documents:s,document712Url:e||""};void 0!==t&&(r.latitude=t),void 0!==a&&(r.longitude=a),_.harvestDate&&(r.harvestDate=S.Timestamp.fromDate(new Date(_.harvestDate))),await (0,N.createClaim)(r),C.toast.success("Claim filed successfully!"),T.push("/farmer/claims")}catch(e){console.error("Error submitting claim:",e),C.toast.error(e.message||"Failed to submit claim")}finally{R(!1)}};return(0,t.jsxs)("div",{className:"flex min-h-screen bg-background",children:[(0,t.jsx)(a.FarmerSidebar,{}),(0,t.jsx)("main",{className:"flex-1 p-2 overflow-auto",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6 max-w-[1800px] items-start",children:[(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("h1",{className:"text-xl font-bold text-foreground font-display",children:"File New Claim"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"AI-Assisted Claim Filing Process"})]}),(0,t.jsxs)("div",{className:"bg-card rounded-xl border border-border shadow-sm p-5 h-fit",children:[(0,t.jsxs)("h2",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[(0,t.jsx)(p.Sparkles,{className:"w-5 h-5 text-primary"}),"1. Upload 7/12 for Analysis"]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Upload the 7/12 document extract. Our AI will analyze it to auto-fill the claim form details."}),(0,t.jsx)("div",{className:"w-full border border-dashed bg-muted/30 border-border rounded-lg overflow-hidden min-h-[200px] mb-4",children:(0,t.jsx)(b.FileUpload,{onChange:e=>{e?.[0]&&(z(e[0]),V(null),$(null))}})}),O&&(0,t.jsxs)("div",{className:"mb-4 p-3 bg-red-500/10 border border-red-500/20 rounded-lg flex items-start gap-2 text-red-600 text-sm",children:[(0,t.jsx)(f.AlertCircle,{className:"w-4 h-4 mt-0.5"}),(0,t.jsx)("span",{children:O})]}),(0,t.jsx)(s.Button,{onClick:Z,disabled:!U||E,className:"w-full gap-2",size:"lg",children:E?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.Loader2,{className:"w-5 h-5 animate-spin"}),"Analyzing Document..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h.Scan,{className:"w-5 h-5"}),"Analyze & Auto-Fill"]})}),B&&(0,t.jsxs)("div",{className:"mt-4 p-4 bg-green-500/10 border border-green-500/20 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-green-700 font-medium mb-2",children:[(0,t.jsx)(x.CheckCircle2,{className:"w-5 h-5"}),"Analysis Complete"]}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground space-y-1",children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Owner:"})," ",B.ownerName]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Village:"})," ",B.village]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Area:"})," ",B.area]}),(0,t.jsx)("p",{className:"text-xs mt-2 text-green-600",children:"Form fields have been auto-filled."})]})]})]}),(0,t.jsxs)("div",{className:"bg-card rounded-xl border border-border shadow-sm p-5 h-fit",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold mb-3",children:"Proof Upload (Geotag Photos)"}),(0,t.jsx)("div",{className:"w-full border border-dashed bg-muted/30 border-border rounded-lg overflow-hidden min-h-[120px]",children:(0,t.jsx)(b.FileUpload,{onChange:e=>H(e),onPreview:L})}),W.length>0&&(0,t.jsx)("div",{className:"mt-3 grid grid-cols-3 gap-2",children:W.map((e,a)=>(0,t.jsxs)("div",{className:"relative group aspect-square rounded-lg overflow-hidden border border-border bg-muted/20",children:[e.type.startsWith("image/")?(0,t.jsx)("img",{src:URL.createObjectURL(e),alt:e.name,className:"w-full h-full object-cover cursor-pointer hover:opacity-80 transition",onClick:()=>L(e)}):(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,t.jsx)(d.FileText,{className:"w-8 h-8 text-muted-foreground"})}),(0,t.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-black/60 text-white text-[10px] px-1 py-0.5 truncate",children:e.name})]},a))}),(0,t.jsx)(s.Button,{onClick:async()=>{if(0===W.length)return void C.toast.error("Please upload an image first");X(!0);try{for(let e of W)if(e.type.startsWith("image/")){let t=await new Promise(t=>{let a=new FileReader;a.onloadend=()=>t(a.result),a.readAsDataURL(e)}),a=await fetch("/api/ocr",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:t})});if(a.ok){let e=await a.json(),t=e.text||"";if(console.log("OCR Text:",t),console.log("Structured Data:",e.structuredData),e.structuredData?.coordinates&&"Not Found"!==e.structuredData.coordinates){let t=e.structuredData.coordinates.match(/(-?\d+\.?\d*)[°\s,]+(-?\d+\.?\d*)/);if(t){let e=parseFloat(t[1]),a=parseFloat(t[2]);if(!isNaN(e)&&!isNaN(a)){let t=`${e.toFixed(6)}, ${a.toFixed(6)}`;q(e=>({...e,farmCoordinates:t})),C.toast.success("Coordinates extracted!",{description:t}),X(!1);return}}}for(let e of[/Lat\s*(-?\d+\.?\d*)°?\s*Long\s*(-?\d+\.?\d*)°?/i,/(-?\d{1,3}\.\d{2,})\s*°?\s*[,\s]+\s*(-?\d{1,3}\.\d{2,})\s*°?/,/lat[itude]*\s*[:=]?\s*(-?\d+\.?\d*)\s*[°,\s]+long[itude]*\s*[:=]?\s*(-?\d+\.?\d*)/i,/[NS]\s*(-?\d+\.?\d*)\s*[,\s]+[EW]\s*(-?\d+\.?\d*)/i]){let a=t.match(e);if(a){console.log("Regex matched:",e,a);let t=parseFloat(a[1]),s=parseFloat(a[2]);if(!isNaN(t)&&!isNaN(s)&&90>=Math.abs(t)&&180>=Math.abs(s)){let e=`${t.toFixed(6)}, ${s.toFixed(6)}`;q(t=>({...t,farmCoordinates:e})),C.toast.success("Coordinates extracted!",{description:e}),X(!1);return}}}}}C.toast.error("No coordinates found in images")}catch(e){console.error("OCR extraction failed:",e),C.toast.error("Failed to extract coordinates")}X(!1)},disabled:0===W.length||Y,className:"w-full mt-3 gap-2",variant:"outline",children:Y?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.Loader2,{className:"w-4 h-4 animate-spin"}),"Extracting Coordinates..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h.Scan,{className:"w-4 h-4"}),"Extract Coordinates from Image"]})})]})]}),(0,t.jsx)("div",{className:"space-y-6",children:(0,t.jsxs)("div",{className:"bg-card rounded-xl border border-border shadow-sm p-4 md:p-5 h-fit",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold mb-3",children:"2. Claim Application Form"}),(0,t.jsxs)("form",{className:"space-y-3",onSubmit:Q,children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(l.Label,{htmlFor:"farmer-id",children:"Farmer ID *"}),(0,t.jsx)(r.Input,{id:"farmer-id",placeholder:"Enter Farmer ID",className:"h-9",value:_.farmerId,onChange:e=>q({..._,farmerId:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(l.Label,{htmlFor:"other-names",children:"Owner Names (from 7/12)"}),(0,t.jsx)(r.Input,{id:"other-names",placeholder:"Extracted names...",className:"h-9 bg-muted/20",value:_.otherNames,readOnly:!0})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(l.Label,{htmlFor:"farmer-name",children:"Farmer Name (Manual Entry) *"}),(0,t.jsx)(r.Input,{id:"farmer-name",placeholder:"Enter Farmer Name",className:"h-9",value:_.farmerName,onChange:e=>q({..._,farmerName:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(l.Label,{htmlFor:"village",children:"Village"}),(0,t.jsx)(r.Input,{id:"village",placeholder:"Village (Auto-filled)",className:"h-9 bg-muted/20",value:_.village,onChange:e=>q({..._,village:e.target.value})})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(l.Label,{htmlFor:"district",children:"District"}),(0,t.jsx)(r.Input,{id:"district",placeholder:"District (Auto-filled)",className:"h-9 bg-muted/20",value:_.district,onChange:e=>q({..._,district:e.target.value})})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(l.Label,{htmlFor:"survey-no",children:"Survey / Gat No"}),(0,t.jsx)(r.Input,{id:"survey-no",placeholder:"Survey No (Auto-filled)",className:"h-9 bg-muted/20",value:_.surveyNo,onChange:e=>q({..._,surveyNo:e.target.value})})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(l.Label,{htmlFor:"crop-type",children:"Crop Type"}),(0,t.jsxs)(n.Select,{value:_.cropType,onValueChange:e=>q({..._,cropType:e}),children:[(0,t.jsx)(n.SelectTrigger,{id:"crop-type",className:"h-9",children:(0,t.jsx)(n.SelectValue,{placeholder:"Select Crop"})}),(0,t.jsxs)(n.SelectContent,{children:[(0,t.jsx)(n.SelectItem,{value:"Rice",children:"Rice"}),(0,t.jsx)(n.SelectItem,{value:"Wheat",children:"Wheat"}),(0,t.jsx)(n.SelectItem,{value:"Cotton",children:"Cotton"}),(0,t.jsx)(n.SelectItem,{value:"Sugarcane",children:"Sugarcane"}),(0,t.jsx)(n.SelectItem,{value:"Maize",children:"Maize"}),(0,t.jsx)(n.SelectItem,{value:"Onion",children:"Onion"}),(0,t.jsx)(n.SelectItem,{value:"Grape",children:"Grape"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(l.Label,{htmlFor:"area",children:"Area (Acres)"}),(0,t.jsx)(r.Input,{id:"area",type:"text",placeholder:"Area (Auto-filled)",className:"h-9 bg-muted/20",value:_.area,onChange:e=>q({..._,area:e.target.value})})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(l.Label,{htmlFor:"policy-number",children:"Policy Number"}),(0,t.jsxs)(n.Select,{value:_.policyNumber,onValueChange:e=>q({..._,policyNumber:e}),children:[(0,t.jsx)(n.SelectTrigger,{id:"policy-number",className:"h-9",children:(0,t.jsx)(n.SelectValue,{placeholder:"Select Policy"})}),(0,t.jsxs)(n.SelectContent,{children:[(0,t.jsx)(n.SelectItem,{value:"PMFBY-2023-001",children:"PMFBY-2023-001 (Rice)"}),(0,t.jsx)(n.SelectItem,{value:"PMFBY-2023-002",children:"PMFBY-2023-002 (Wheat)"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(l.Label,{htmlFor:"loss-date",children:"Date of Loss *"}),(0,t.jsx)(r.Input,{type:"date",id:"loss-date",className:"h-9",value:_.lossDate,onChange:e=>q({..._,lossDate:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(l.Label,{htmlFor:"loss-type",children:"Type of Loss *"}),(0,t.jsxs)(n.Select,{value:_.lossType,onValueChange:e=>q({..._,lossType:e}),children:[(0,t.jsx)(n.SelectTrigger,{id:"loss-type",className:"h-9",children:(0,t.jsx)(n.SelectValue,{placeholder:"Select Loss Type"})}),(0,t.jsxs)(n.SelectContent,{children:[(0,t.jsx)(n.SelectItem,{value:"drought",children:"Drought"}),(0,t.jsx)(n.SelectItem,{value:"flood",children:"Flood / Excess Rain"}),(0,t.jsx)(n.SelectItem,{value:"pest",children:"Pest Attack"}),(0,t.jsx)(n.SelectItem,{value:"fire",children:"Fire"}),(0,t.jsx)(n.SelectItem,{value:"landslide",children:"Landslide"}),(0,t.jsx)(n.SelectItem,{value:"hailstorm",children:"Hailstorm"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(l.Label,{htmlFor:"crop-stage",children:"Crop Stage *"}),(0,t.jsxs)(n.Select,{value:_.cropStage,onValueChange:e=>q({..._,cropStage:e}),children:[(0,t.jsx)(n.SelectTrigger,{id:"crop-stage",className:"h-9",children:(0,t.jsx)(n.SelectValue,{placeholder:"Select Stage"})}),(0,t.jsxs)(n.SelectContent,{children:[(0,t.jsx)(n.SelectItem,{value:"sowing",children:"Sowing / Planting"}),(0,t.jsx)(n.SelectItem,{value:"vegetative",children:"Vegetative Growth"}),(0,t.jsx)(n.SelectItem,{value:"flowering",children:"Flowering"}),(0,t.jsx)(n.SelectItem,{value:"maturity",children:"Maturity / Harvesting"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(l.Label,{htmlFor:"harvest-date",children:"Date of Harvest (Optional)"}),(0,t.jsx)(r.Input,{type:"date",id:"harvest-date",className:"h-9",value:_.harvestDate,onChange:e=>q({..._,harvestDate:e.target.value})})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(l.Label,{htmlFor:"farm-coordinates",children:"Farm Coordinates"}),(0,t.jsx)(r.Input,{id:"farm-coordinates",placeholder:"e.g. 19.0760, 72.8777",className:"h-9",value:_.farmCoordinates,onChange:e=>q({..._,farmCoordinates:e.target.value})})]})]}),(0,t.jsxs)("div",{className:"space-y-1.5 pt-2",children:[(0,t.jsx)(l.Label,{htmlFor:"description",children:"Description of Loss"}),(0,t.jsx)(i.Textarea,{id:"description",placeholder:"Describe how the damage occurred... (Auto-filled with additional data)",className:"min-h-[100px] resize-none",value:_.description,onChange:e=>q({..._,description:e.target.value})})]}),(0,t.jsxs)("div",{className:"pt-4 flex justify-end gap-3",children:[(0,t.jsx)(s.Button,{variant:"outline",type:"button",size:"sm",onClick:()=>T.push("/farmer/claims"),children:"Cancel"}),(0,t.jsx)(s.Button,{type:"submit",className:"gap-2",size:"sm",disabled:P||!I,children:P?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.Loader2,{className:"w-4 h-4 animate-spin"}),"Submitting..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.Send,{className:"w-4 h-4"}),"Submit Claim"]})})]})]})]})})]})}),(0,t.jsx)(v.AnimatePresence,{children:A&&(0,t.jsx)(y.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",onClick:()=>L(null),children:(0,t.jsxs)(y.motion.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"relative bg-white dark:bg-neutral-900 rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-hidden",onClick:e=>e.stopPropagation(),children:[(0,t.jsx)("button",{onClick:()=>L(null),className:"absolute top-4 right-4 p-2 rounded-full bg-black/10 hover:bg-black/20 dark:bg-white/10 dark:hover:bg-white/20 transition-colors z-10",children:(0,t.jsx)(j.IconX,{className:"w-5 h-5"})}),(0,t.jsx)("div",{className:"p-2 h-full flex items-center justify-center bg-neutral-100 dark:bg-neutral-950",children:A.type.startsWith("image/")?(0,t.jsx)("img",{src:URL.createObjectURL(A),alt:"Preview",className:"max-w-full max-h-[80vh] object-contain rounded-md"}):(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4 p-12",children:[(0,t.jsx)(d.FileText,{className:"w-16 h-16 text-neutral-400"}),(0,t.jsx)("p",{className:"text-lg font-medium text-neutral-700 dark:text-neutral-300",children:A.name}),(0,t.jsx)("p",{className:"text-sm text-neutral-500",children:"Preview not available for this file type"})]})})]})})})]})}e.s(["default",()=>D])}]);